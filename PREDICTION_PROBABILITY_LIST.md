# 번호 예측 시 확률적으로 선택되는 항목 리스트

## 1. 중복 빈도 패턴 선택 (Frequency Pattern Selection)
- **선택 방식**: 룰렛 휠 방식 (가중치 기반)
- **선택 항목**: 0개, 2개, 3개, 4개, 5개, 6개 중복
- **가중치 기준**: `duplicateFrequencyAnalysis.frequencyDistribution`의 각 빈도별 발생 횟수
- **위치**: 라인 42-67
- **설명**: 과거 데이터에서 각 중복 빈도가 나타난 횟수를 가중치로 사용하여 선택

## 2. 배치 패턴 사용 여부 결정
- **선택 방식**: 50% 확률 (Math.random() < 0.5)
- **조건**: selectedFrequency가 2일 때만 고려
- **위치**: 라인 70
- **설명**: 1개 숫자가 2번 중복되는 경우, 배치 패턴을 사용할지 결정

## 3. 배치 패턴 선택 (Position Pattern Selection)
- **선택 방식**: 룰렛 휠 방식 (가중치 기반)
- **가중치 기준**: 각 패턴의 발생 횟수 (`positionPatternAnalysis.patternDetails[].count`)
- **위치**: 라인 77-92
- **설명**: O/X 패턴(예: OOXXXX, OXOXOX 등) 중 빈도가 높은 패턴일수록 더 높은 확률로 선택

## 4. 중복될 숫자 선택 (Duplicate Digit Selection)
- **선택 방식**: 룰렛 휠 방식 (가중치 기반)
- **가중치 기준**: 각 숫자가 1개 중복으로 나타난 횟수 (`duplicateAnalysis.singleDuplicateDigitRanking[].count`)
- **위치**: 라인 95-114
- **설명**: 배치 패턴 사용 시, 중복될 숫자를 과거 데이터의 중복 빈도를 기반으로 선택

## 5. 각 자리별 숫자 선택 (Position-based Digit Selection)
- **선택 방식**: 룰렛 휠 방식 (복합 가중치 기반)
- **가중치 계산식**: `(빈도 + 1) × (1 + 전이확률 × 5)`
  - 빈도: 해당 자리에서 각 숫자가 나타난 횟수 (`positionFreq[pos].digitFrequency[digit]`)
  - 전이 확률: 직전 회차의 해당 자리 숫자에서 현재 숫자로 전이될 확률 (`transitionProb[digit]`)
  - 전이 확률에 5배 가중치 적용
- **위치**: 
  - 배치 패턴 사용 시: 라인 130-168
  - 중복 없음 패턴: 라인 177-227
  - 중복 있음 패턴: 라인 270-313
- **설명**: 각 자리별로 과거 빈도와 직전 회차 전이 패턴을 결합하여 숫자 선택

## 6. 중복 위치 선택 (Duplicate Position Selection)
- **선택 방식**: 완전 랜덤 (균등 확률)
- **선택 항목**: 6개 자리 중 selectedFrequency 개수만큼 선택
- **위치**: 라인 256-259
- **설명**: 중복될 숫자를 배치할 위치를 무작위로 선택

## 7. 합계 조정 시 위치 선택 (Sum Adjustment Position Selection)
- **선택 방식**: 완전 랜덤 (균등 확률)
- **선택 항목**: 6개 자리 중 조정할 위치
- **조정 로직**: 목표 합계에 근접하도록 최대 100번 시도
- **위치**: 라인 321-346
- **설명**: 생성된 숫자의 합계가 목표 합계(평균과 최빈값의 중간값)에 가깝도록 조정

## 8. 변화량 범위 내 랜덤 차이 선택 (Change Range Random Selection)
- **선택 방식**: 완전 랜덤 (균등 확률)
- **선택 범위**: `effectiveLowerBound` ~ `effectiveUpperBound`
  - effectiveLowerBound = max(minChange, avgAllChange - stdDeviation × 1.5)
  - effectiveUpperBound = min(maxChange, avgAllChange + stdDeviation × 1.5)
- **위치**: 라인 400-415
- **설명**: 마지막 회차와의 차이가 통계적 범위를 벗어날 경우, 범위 내의 랜덤한 차이로 재생성

## 가중치 계산 상세

### 각 자리별 숫자 선택 가중치 공식
```
combinedWeight = (빈도 + 1) × (1 + 전이확률 × 5)
```

- **빈도**: 해당 자리에서 숫자가 나타난 횟수
- **전이 확률**: 직전 회차의 해당 자리 숫자에서 현재 숫자로 전이될 확률 (0~1)
- **전이 확률 가중치**: 5배 (전이 패턴을 더 중요하게 반영)

### 룰렛 휠 방식 선택 알고리즘
1. 모든 항목의 가중치 합계 계산
2. 0 ~ 합계 사이의 랜덤 값 생성
3. 가중치를 순차적으로 빼면서 랜덤 값이 0 이하가 되는 첫 번째 항목 선택

## 확률 기반 선택의 우선순위

1. **중복 빈도 패턴** → 전체 구조 결정
2. **배치 패턴 사용 여부** (조건부) → 패턴 방식 결정
3. **배치 패턴 선택** (조건부) → 구체적 패턴 결정
4. **중복 숫자 선택** → 중복될 숫자 결정
5. **각 자리별 숫자 선택** → 각 위치의 숫자 결정
6. **합계 조정** → 목표 합계에 맞춤
7. **변화량 범위 조정** → 통계적 범위 내로 조정

## 참고사항

- 모든 확률적 선택은 과거 데이터의 통계를 기반으로 함
- 룰렛 휠 방식은 빈도가 높을수록 선택될 확률이 높아짐
- 전이 패턴은 각 자리별 숫자 선택 시 5배 가중치로 반영됨
- 합계와 변화량 범위는 생성 후 조정 단계에서 검증 및 수정됨

